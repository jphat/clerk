---
/**
 * Test page for PermissionMenu component
 *
 * This page demonstrates the permission-aware menu functionality
 * with different user roles and permission levels.
 */

import { Check, X } from 'lucide-vue-next';
import TitleBar from '@/components/site/TitleBar.astro';
import Layout from '@/layouts/Layout.astro';
import PermissionMenu from '@/components/auth/PermissionMenu.astro';
import MenuExample from '@/components/auth/MenuExample.astro';
import AdvancedMenuExample from '@/components/auth/AdvancedMenuExample.astro';
import type { MenuItem } from '@/types/auth';
import type { PageMeta } from '@/types';

const pageMeta: PageMeta = {
	title: 'Permission Menu Test',
	description:
		'Test page for permission-aware menu functionality with different user roles and permission levels.',
};

// Example menu configurations for testing
const mainMenu: MenuItem[] = [
	{
		label: 'Dashboard',
		href: '/u',
		// No permissions - visible to all authenticated users
	},
	{
		label: 'Content Management',
		href: '/content',
		permissions: ['write_content', 'edit_content'],
		children: [
			{
				label: 'Create Article',
				href: '/content/create',
				permissions: ['write_content'],
			},
			{
				label: 'Edit Articles',
				href: '/content/edit',
				permissions: ['edit_content'],
			},
			{
				label: 'Draft Articles',
				href: '/content/drafts',
				permissions: ['write_content'],
			},
		],
	},
	{
		label: 'User Management',
		href: '/a/users',
		permissions: ['manage_user'],
		children: [
			{
				label: 'View Users',
				href: '/a/users/list',
				permissions: ['manage_user'],
			},
			{
				label: 'Add User',
				href: '/a/users/create',
				permissions: ['manage_user'],
			},
			{
				label: 'User Roles',
				href: '/a/users/roles',
				permissions: ['manage_user'],
			},
		],
	},
	{
		label: 'Settings',
		href: '/settings',
		// No permissions - visible to all authenticated users
	},
];

const editorMenu: MenuItem[] = [
	{
		label: 'My Content',
		href: '/my-content',
		permissions: ['write_content', 'edit_content'],
	},
	{
		label: 'Publishing',
		href: '/publish',
		permissions: ['edit_content'],
		children: [
			{
				label: 'Review Queue',
				href: '/publish/review',
				permissions: ['edit_content'],
			},
			{
				label: 'Published',
				href: '/publish/published',
				permissions: ['edit_content'],
			},
		],
	},
];

const publicMenu: MenuItem[] = [
	{
		label: 'Home',
		href: '/',
	},
	{
		label: 'About',
		href: '/about',
	},
	{
		label: 'Contact',
		href: '/contact',
	},
];
---

<Layout pageMeta={pageMeta}>
	<TitleBar
		breadcrumbs={[
			{ title: 'Home', url: '/' },
			{ title: 'Test', url: '/test' },
			{ title: pageMeta.title, url: '' },
		]}
		description={pageMeta.description}
		title={pageMeta.title}
	/>

	<div class="container">
		<div class="mb-12 p-6 border">
			<h2 class="text-2xl font-semibold mb-4">Main Navigation Menu</h2>
			<p class="mb-6">
				This menu shows different items based on your current role and
				permissions:
			</p>
			<!-- <div class="bg-foreground/10 border rounded p-4 mt-4 shadow-sm"> -->
			<div class="bg-foreground/5 border rounded p-4 mt-4 shadow-sm">
				<PermissionMenu items={mainMenu} className="main-nav" />
			</div>
		</div>

		<div class="mb-12 p-6 border">
			<h2 class="text-2xl font-semibold mb-4">Editor-Specific Menu</h2>
			<p class="mb-6">This menu is designed for content editors:</p>
			<div class="bg-foreground/5 border rounded p-4 mt-4 shadow-sm">
				<PermissionMenu items={editorMenu} className="editor-nav" />
			</div>
		</div>

		<div class="mb-12 p-6 border">
			<h2 class="text-2xl font-semibold mb-4">
				Public Menu (No Permissions Required)
			</h2>
			<p class="mb-6">
				This menu is visible to all users, including unauthenticated ones:
			</p>
			<div class="bg-foreground/5 border rounded p-4 mt-4 shadow-sm">
				<PermissionMenu items={publicMenu} className="public-nav" />
			</div>
		</div>

		<div class="mb-12 p-6 border">
			<h2 class="text-2xl font-semibold mb-4">Menu Example Component</h2>
			<p class="mb-6">This demonstrates the pre-configured menu example:</p>
			<MenuExample />
		</div>

		<div class="mb-12 p-6 border">
			<h2 class="text-2xl font-semibold mb-4">Advanced Menu Examples</h2>
			<p class="mb-6">
				Complex menu configurations with nested permissions and detailed
				analysis:
			</p>
			<AdvancedMenuExample />
		</div>

		<div class="mb-12 p-6 border">
			<h2 class="text-2xl font-semibold mb-4">Current User Context</h2>
			<p class="mb-6">Your current authentication and permission status:</p>
			<div class="bg-foreground/5 p-6 border mt-4">
				{
					Astro.locals.user ? (
						<div class="text-green-800 dark:text-green-200 bg-green-100 dark:bg-green-900/30 p-4 rounded border border-green-300 dark:border-green-700">
							<p class="mb-2">
								<strong>Status:</strong> Authenticated
							</p>
							<p class="mb-2">
								<strong>Role:</strong> {Astro.locals.user.role}
							</p>
							<p class="mb-2">
								<strong>Permissions:</strong>{' '}
								{Astro.locals.user.permissions.length > 0
									? Astro.locals.user.permissions.join(', ')
									: 'None'}
							</p>
							<p class="mb-0">
								<strong>User ID:</strong> {Astro.locals.user.id}
							</p>
						</div>
					) : (
						<div class="text-red-800 dark:text-red-200 bg-red-100 dark:bg-red-900/30 p-4 rounded border border-red-300 dark:border-red-700">
							<p class="mb-2">
								<strong>Status:</strong> Not authenticated
							</p>
							<p class="mb-4">
								Sign in to see role-based menu filtering in action.
							</p>
							<a
								href="/sign-in"
								class="inline-block mt-2 px-4 py-2 bg-blue-500 dark:bg-blue-600 text-white no-underline rounded font-medium hover:bg-blue-600 dark:hover:bg-blue-700 transition-colors"
							>
								Sign In
							</a>
						</div>
					)
				}
			</div>
		</div>

		<div class="mb-12 p-6 border">
			<h2 class="text-2xl font-semibold mb-4">Test Different Roles</h2>
			<p class="mb-6">
				Visit these pages to see how the interface adapts to different
				permission levels:
			</p>
			<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-4">
				<div class="bg-foreground/5 border p-6">
					<h3
						class="mt-0 mb-2 text-gray-800 dark:text-gray-200 text-lg font-semibold"
					>
						Admin Test Page
					</h3>
					<p class="mb-4">Full administrative access with all permissions</p>
					<ul class="list-none m-0 mb-6 p-0 space-y-4">
						<li class="flex gap-2">
							<Check class="stroke-green-600" /> User management
						</li>
						<li class="flex gap-2">
							<Check class="stroke-green-600" /> Content creation
						</li>
						<li class="flex gap-2">
							<Check class="stroke-green-600" /> Content editing
						</li>
						<li class="flex gap-2">
							<Check class="stroke-green-600" /> System settings
						</li>
					</ul>
					<a
						href="/test/admin"
						class="block text-center px-4 py-3 rounded no-underline font-medium transition-colors bg-red-500 dark:bg-red-600 text-white hover:bg-red-600 dark:hover:bg-red-700"
						>Visit Admin Page</a
					>
				</div>
				<div
					class="bg-foreground/10 border p-6 shadow-sm transition-all duration-200 hover:-translate-y-0.5 hover:shadow-md dark:hover:shadow-lg"
				>
					<h3
						class="mt-0 mb-2 text-gray-800 dark:text-gray-200 text-lg font-semibold"
					>
						Editor Test Page
					</h3>
					<p class="mb-4">Content management permissions</p>
					<ul class="list-none m-0 mb-6 p-0 space-y-4">
						<li class="flex gap-2">
							<X class="stroke-destructive" /> User management
						</li>
						<li class="flex gap-2">
							<Check class="stroke-green-600" /> Content creation
						</li>
						<li class="flex gap-2">
							<Check class="stroke-green-600" /> Content editing
						</li>
						<li class="flex gap-2">
							<X class="stroke-destructive" /> System settings
						</li>
					</ul>
					<a
						href="/test/editor"
						class="block text-center px-4 py-3 rounded no-underline font-medium transition-colors bg-green-500 dark:bg-green-600 text-white hover:bg-green-600 dark:hover:bg-green-700"
						>Visit Editor Page</a
					>
				</div>
				<div
					class="bg-foreground/10 border p-6 shadow-sm transition-all duration-200 hover:-translate-y-0.5 hover:shadow-md dark:hover:shadow-lg"
				>
					<h3
						class="mt-0 mb-2 text-gray-800 dark:text-gray-200 text-lg font-semibold"
					>
						Viewer Test Page
					</h3>
					<p class="mb-4">Read-only access with no special permissions</p>
					<ul class="list-none m-0 mb-6 p-0 space-y-4">
						<li class="flex gap-2">
							<X class="stroke-destructive" /> User management
						</li>
						<li class="flex gap-2">
							<X class="stroke-destructive" /> Content creation
						</li>
						<li class="flex gap-2">
							<X class="stroke-destructive" /> Content editing
						</li>
						<li class="flex gap-2">
							<X class="stroke-destructive" /> System settings
						</li>
					</ul>
					<a
						href="/test/viewer"
						class="block text-center px-4 py-3 rounded no-underline font-medium transition-colors bg-gray-500 dark:bg-gray-600 text-white hover:bg-gray-600 dark:hover:bg-gray-700"
						>Visit Viewer Page</a
					>
				</div>
			</div>
		</div>
	</div>
</Layout>
