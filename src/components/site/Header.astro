---
import { Zap } from 'lucide-vue-next';
import { Button } from '@/components/ui/button';
import {
	SignedIn,
	UserButton,
	SignInButton,
	SignedOut,
} from '@clerk/astro/components';
import {
	canManageUser,
	isAdmin,
	canWriteContent,
} from '@/lib/auth/template-utils';

// Get user context from locals
const user = Astro.locals.user;
---

<header
	class="sticky top-0 z-50 w-full border-b border-border bg-background/95 backdrop-blur supports-backdrop-filter:bg-background/60"
>
	<nav
		class="container flex max-w-7xl items-center justify-between p-6 lg:px-8"
		aria-label="Global"
	>
		<!-- Logo/Home Link -->
		<a href="/">
			<Zap class="h-8 w-8 stroke-1" />
		</a>

		<!-- Main Navigation Menu (visible when signed in) -->
		<SignedIn>
			<nav class="hidden md:flex items-center space-x-6">
				<a href="/dashboard" class="text-sm font-medium hover:text-primary">
					Dashboard
				</a>

				{
					canWriteContent(Astro.locals) && (
						<a
							href="/content/create"
							class="text-sm font-medium hover:text-primary"
						>
							Create Content
						</a>
					)
				}

				{
					canManageUser(Astro.locals) && (
						<a href="/users" class="text-sm font-medium hover:text-primary">
							Manage Users
						</a>
					)
				}

				{
					isAdmin(Astro.locals) && (
						<a href="/admin" class="text-sm font-medium hover:text-primary">
							Admin
						</a>
					)
				}
			</nav>
		</SignedIn>

		<!-- Authentication Section -->
		<div class="flex items-center space-x-2">
			<SignedIn>
				<UserButton
					appearance={{
						elements: {
							avatarBox: 'w-8 h-8',
							userButtonPopoverActionButtonIcon: 'hidden',
							userButtonPopoverActionButtonIconBox: 'hidden',
						},
					}}
					userProfileMode="modal"
				>
					<UserButton.MenuItems>
						<UserButton.Link label="Dashboard" href="/u" />
						{
							canWriteContent(Astro.locals) && (
								<UserButton.Link
									label="Create Content"
									href="/content/create"
								/>
							)
						}
						{
							canManageUser(Astro.locals) && (
								<UserButton.Link label="Manage Users" href="/users" />
							)
						}
						{
							isAdmin(Astro.locals) && (
								<UserButton.Link label="Admin Panel" href="/admin" />
							)
						}
					</UserButton.MenuItems>
				</UserButton>
			</SignedIn>

			<!-- Non-authenticated User Buttons -->
			<SignedOut>
				<Button variant="default" size="sm"
					><a href="/sign-in"> Sign In </a></Button
				>
				<Button variant="secondary" size="sm"
					><a href="/sign-up"> Sign Up </a></Button
				>
			</SignedOut>
		</div>
	</nav>
</header>
