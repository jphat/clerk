---
/**
 * Example component demonstrating template utility usage
 *
 * This component shows how to use the RBAC template utilities
 * for conditional rendering based on user permissions and roles.
 */

import { Button } from '@/components/ui/button';
import {
	canWriteContent,
	canEditContent,
	canManageUser,
	hasRole,
	isAdmin,
	isAuthenticated,
} from '@/lib/auth';

// Get user context from Astro locals
const userCanWrite = canWriteContent(Astro.locals);
const userCanEdit = canEditContent(Astro.locals);
const userCanManage = canManageUser(Astro.locals);
const userIsAdmin = isAdmin(Astro.locals);
const userIsEditor = hasRole(Astro.locals, 'editor');
const userIsAuthenticated = isAuthenticated(Astro.locals);
---

<div class="p-4 border rounded my-4 bg-foreground/5">
	<h3 class="text-xl font-semibold mb-4">Permission-Based Content</h3>

	{
		userIsAuthenticated ? (
			<div class="space-y-4">
				<p>Welcome, authenticated user!</p>

				<div class="flex flex-wrap gap-2">
					{userCanWrite && <Button variant="outline">Create Content</Button>}

					{userCanEdit && <Button variant="outline">Edit Content</Button>}

					{userCanManage && <Button variant="outline">Manage Users</Button>}
				</div>

				{userIsAdmin && (
					<div class="bg-destructive/5 p-4 rounded border border-destructive/50 my-2 text-destructive">
						<h3 class="text-lg font-medium mb-2">Admin Panel</h3>
						<p>Admin-only content visible here</p>
					</div>
				)}

				{/* 
				TODO: admin should also have editor role
				{userIsEditor && (
					<div class="bg-foreground/5 p-4 rounded border border-foreground/50 my-2 text-foreground">
						<h3 class="text-lg font-medium mb-2">Editor Tools</h3>
						<p>Editor-specific tools available</p>
					</div>
				)} */}
			</div>
		) : (
			<div class="space-y-4">
				<p>Please sign in to access content.</p>
				<Button variant="default">
					<a href="/sign-in">Sign In</a>
				</Button>
			</div>
		)
	}
</div>
